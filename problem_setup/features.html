<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Additional Features &mdash; Nek5000  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tutorials" href="../tutorials.html" />
    <link rel="prev" title="Stabilizing Filters" href="filter.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Nek5000
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../problem_setup.html">Problem Setup</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="BCs.html">Boundary Conditions</a></li>
<li class="toctree-l2"><a class="reference internal" href="case_files.html">Case Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="usr_file.html">User Routines File (.usr)</a></li>
<li class="toctree-l2"><a class="reference internal" href="filter.html">Stabilizing Filters</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Additional Features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#history-points">History Points</a></li>
<li class="toctree-l3"><a class="reference internal" href="#grid-to-grid-interpolation">Grid-to-Grid Interpolation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#restart-options">Restart Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#averaging">Averaging</a></li>
<li class="toctree-l3"><a class="reference internal" href="#post-processing">Post Processing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#objects">Objects</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../theory.html">Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build.html">Build Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix.html">Appendices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Nek5000</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../problem_setup.html">Problem Setup</a> &raquo;</li>
      <li>Additional Features</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/problem_setup/features.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="additional-features">
<h1>Additional Features<a class="headerlink" href="#additional-features" title="Permalink to this heading"></a></h1>
<p><em>Nek5000</em> includes several features which make case setup, running, and data processing much easier.
These capabilities are outlined here.</p>
<section id="history-points">
<span id="features-his"></span><h2>History Points<a class="headerlink" href="#history-points" title="Permalink to this heading"></a></h2>
<p>Assuming a case named <code class="docutils literal notranslate"><span class="pre">foo</span></code>, a list of monitor points can be defined in the file <code class="docutils literal notranslate"><span class="pre">foo.his</span></code> to evaluate velocity, temperature, pressure and passive scalars.
Values for each scalar will be spectrally interpolated to each point and appended to this file each time the subroutine <code class="docutils literal notranslate"><span class="pre">hpts()</span></code> is called.
The values printed to this file are controlled by the <code class="docutils literal notranslate"><span class="pre">writeToFieldFile</span></code> parameters for each quantity in the <code class="docutils literal notranslate"><span class="pre">.par</span></code> file.
Depending on the number of monitoring points, you may need to increase parameter <code class="docutils literal notranslate"><span class="pre">lhis</span></code> in SIZE.
Note that the monitoring points are assumed to be distributed among MPI ranks, so it may be necessary to increase <code class="docutils literal notranslate"><span class="pre">lhis</span></code> above the actual number of history points requested.</p>
<p>Usage example:</p>
<ul>
<li><p>setup an ASCII file called <code class="docutils literal notranslate"><span class="pre">foo.his</span></code>, e.g.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>3 !number of monitoring points
1.1 -1.2 1.0
. . .
x y z
</pre></div>
</div>
</li>
<li><p>add <code class="docutils literal notranslate"><span class="pre">call</span> <span class="pre">hpts()</span></code> to <code class="docutils literal notranslate"><span class="pre">userchk()</span></code></p></li>
</ul>
</section>
<section id="grid-to-grid-interpolation">
<span id="features-gfldr"></span><h2>Grid-to-Grid Interpolation<a class="headerlink" href="#grid-to-grid-interpolation" title="Permalink to this heading"></a></h2>
<p><em>Nek5000</em> includes the capability to transfer a solution from one mesh to an entirely different mesh.
This allows a user to restart from an existing field file with a new mesh.
This is accomplished by calling the generic field reader which will spectrally interpolate a result file from a previous case.
If using the latest master branch from github, this can be done by specifying the <code class="docutils literal notranslate"><span class="pre">int</span></code> restart option in the <code class="docutils literal notranslate"><span class="pre">.par</span></code> file.
For example, to interpolate a result from case <code class="docutils literal notranslate"><span class="pre">foo</span></code>:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[GENERAL]</span><span class="w"></span>
<span class="na">startFrom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">foo0.f00001 int</span><span class="w"></span>
</pre></div>
</div>
<p>When invoked from the <code class="docutils literal notranslate"><span class="pre">.par</span></code> file, the <code class="docutils literal notranslate"><span class="pre">int</span></code> option is compatible with all other restart options, except for <code class="docutils literal notranslate"><span class="pre">X</span></code>.</p>
<p>To use this feature in V19, add a call to the <code class="docutils literal notranslate"><span class="pre">gfldr</span></code> subroutine in <code class="docutils literal notranslate"><span class="pre">userchk</span></code> in the user routines file.</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">-----------------------------------------------------------------------</span><span class="w"></span>
<span class="w">      </span><span class="k">subroutine </span><span class="n">userchk</span><span class="p">()</span><span class="w"></span>

<span class="n">c</span><span class="w">      </span><span class="k">implicit none</span>

<span class="k">      include</span><span class="w"> </span><span class="s1">&#39;SIZE&#39;</span><span class="w"></span>
<span class="w">      </span><span class="k">include</span><span class="w"> </span><span class="s1">&#39;TOTAL&#39;</span><span class="w"></span>

<span class="hll"><span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">istep</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">gfldr</span><span class="p">(</span><span class="s2">&quot;foo0.f00001&quot;</span><span class="p">)</span><span class="w"></span>
</span>
<span class="w">      </span><span class="k">return</span>
<span class="k">      end</span>
<span class="n">c</span><span class="o">-----------------------------------------------------------------------</span><span class="w"></span>
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">foo0.f00001</span></code> must include the coordinates, i.e.it must have been created from a run with <code class="docutils literal notranslate"><span class="pre">writeToFieldFile</span> <span class="pre">=</span> <span class="pre">yes</span></code> in the <code class="docutils literal notranslate"><span class="pre">[MESH]</span></code> section of the <code class="docutils literal notranslate"><span class="pre">.par</span></code> file and that selection of specific fields to read is not currently supported.
That means all fields included in <code class="docutils literal notranslate"><span class="pre">foo.f00001</span></code> will be overwritten.</p>
</section>
<section id="restart-options">
<span id="features-restart"></span><h2>Restart Options<a class="headerlink" href="#restart-options" title="Permalink to this heading"></a></h2>
<p>By default, <em>Nek5000</em> will read all available variables from the restart file.
Restart options can be added after the filename in the <code class="docutils literal notranslate"><span class="pre">.par</span></code> file to control which variables are loaded, to manually set the time, and in the latest github version, to specify an interpolated restart (see <a class="reference internal" href="#features-gfldr"><span class="std std-ref">Grid-to-Grid Interpolation</span></a>).
To control which variables are read from a restart file, add an additional string composed of the following:</p>
<table class="colwidths-given docutils align-default" id="id1">
<caption><span class="caption-number">Table 26 </span><span class="caption-text">Variables loaded with restart options</span><a class="headerlink" href="#id1" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 40%" />
<col style="width: 60%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable</p></th>
<th class="head"><p>Characters</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Coordinates</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">X</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Velocity</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">U</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Pressure</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">P</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Temperature</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">T</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Passive scalar ‘i’</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Si</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>reset time</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">time=0.0</span></code></p></td>
</tr>
</tbody>
</table>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p>The following directive will load only velocity and passive scalar 2, and set the physical time to 5.0.</p>
</dd>
</dl>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[GENERAL]</span><span class="w"></span>
<span class="na">startFrom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">foo0.f00001 US2 time=5.0</span><span class="w"></span>
</pre></div>
</div>
<p>Additionally, <em>Nek5000</em> supports loading multiple files simultaneously by providing a list of comma separated filenames.
With the default behavior, each subsequent file will overwrite everything loaded with the previous file.
However, by making use of the restart options, a Frankenstein’s Monster type of restart can be created combining fields from multiple solution files.</p>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p>The following directive will load the mesh coordinates from the first file, <code class="docutils literal notranslate"><span class="pre">mshfoo0.f00001</span></code>, then interpolate velocity, pressure and temperature from the second file, <code class="docutils literal notranslate"><span class="pre">foo0.f00001</span></code> onto the new coordinates.</p>
</dd>
</dl>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[GENERAL]</span><span class="w"></span>
<span class="na">startFrom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">mshfoo0.f00001 X, foo0.f00001 UPT int</span><span class="w"></span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Feature</dt>
<dd class="field-odd"><p>If a restart file contains coordinates, <em>Nek5000</em> will overwrite the coordinates generated from the <code class="docutils literal notranslate"><span class="pre">.re2</span></code> file. This behavior may or may not be desirable, use the restart options to control it!</p>
</dd>
</dl>
</section>
<section id="averaging">
<span id="features-avg"></span><h2>Averaging<a class="headerlink" href="#averaging" title="Permalink to this heading"></a></h2>
<p>When running a high fidelity case with DNS or LES turbulence models, it is often necessary to time-average the solution fields to extract meaningful quantities.
This may sometimes even be useful for a URANS case as well.
<em>Nek5000</em> includes a subroutine for calculating a running time-average of all the primitive variables, i.e. <span class="math notranslate nohighlight">\(u\)</span>, <span class="math notranslate nohighlight">\(v\)</span>, <span class="math notranslate nohighlight">\(w\)</span>, <span class="math notranslate nohighlight">\(p\)</span>, and <span class="math notranslate nohighlight">\(T\)</span>, as well as the second order terms <span class="math notranslate nohighlight">\(u^2\)</span>, <span class="math notranslate nohighlight">\(v^2\)</span>, <span class="math notranslate nohighlight">\(w^2\)</span>, <span class="math notranslate nohighlight">\(uv\)</span>, <span class="math notranslate nohighlight">\(uw\)</span>, and <span class="math notranslate nohighlight">\(vw\)</span>.
Which can be used to reconstruct the Reynolds stresses.
To activate time-averaging, simply call <code class="docutils literal notranslate"><span class="pre">avg_all</span></code> in <code class="docutils literal notranslate"><span class="pre">userchk</span></code>.</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">-----------------------------------------------------------------------</span><span class="w"></span>
<span class="w">      </span><span class="k">subroutine </span><span class="n">userchk</span><span class="p">()</span><span class="w"></span>

<span class="n">c</span><span class="w">      </span><span class="k">implicit none</span>

<span class="k">      include</span><span class="w"> </span><span class="s1">&#39;SIZE&#39;</span><span class="w"></span>
<span class="w">      </span><span class="k">include</span><span class="w"> </span><span class="s1">&#39;TOTAL&#39;</span><span class="w"></span>

<span class="hll"><span class="w">      </span><span class="k">call </span><span class="n">avg_all</span><span class="w"></span>
</span>
<span class="w">      </span><span class="k">return</span>
<span class="k">      end</span>
<span class="n">c</span><span class="o">-----------------------------------------------------------------------</span><span class="w"></span>
</pre></div>
</div>
<p>Adding this call to <code class="docutils literal notranslate"><span class="pre">userchk</span></code> will output three additional files, <code class="docutils literal notranslate"><span class="pre">avgfoo</span></code>, <code class="docutils literal notranslate"><span class="pre">rmsfoo</span></code>, and <code class="docutils literal notranslate"><span class="pre">rm2foo</span></code>, where “foo” is your case name.
As the case is running, the running averages are stored in memory in the arrays documented <a class="reference internal" href="../appendix.html#sec-avgvars"><span class="std std-ref">here</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">WARNING</dt>
<dd class="field-odd"><p>Averaging files are written in double precision by default and can very quickly consume a large amount of disk space!</p>
</dd>
</dl>
<p>These files will be written at the same interval as the standard restart output.
When the files are written, the averaging restarts.
The average files thus only contain averages over the window specified by <code class="docutils literal notranslate"><span class="pre">writeInterval</span></code> in the <code class="docutils literal notranslate"><span class="pre">.par</span></code> file.</p>
<p>The complete list of variables, including which file they are written to and the scalar position they occupy in that file are specified in the table below.
Additionally, the width of the time-window is recorded as the physical time in each average file.</p>
<table class="colwidths-given docutils align-default" id="id2">
<caption><span class="caption-number">Table 27 </span><span class="caption-text">Variables included in <code class="docutils literal notranslate"><span class="pre">avg_all</span></code></span><a class="headerlink" href="#id2" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 14%" />
<col style="width: 43%" />
<col style="width: 43%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable</p></th>
<th class="head"><p>filename</p></th>
<th class="head"><p>scalar</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\overline{u}\)</span></p></td>
<td><p>avgfoo0.f00000</p></td>
<td><p>u-velocity</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\overline{v}\)</span></p></td>
<td><p>avgfoo0.f00000</p></td>
<td><p>v-velocity</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\overline{w}\)</span></p></td>
<td><p>avgfoo0.f00000</p></td>
<td><p>w-velocity</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\overline{p}\)</span></p></td>
<td><p>avgfoo0.f00000</p></td>
<td><p>pressure</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\overline{T}\)</span></p></td>
<td><p>avgfoo0.f00000</p></td>
<td><p>temperature</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\overline{\phi_i}\)</span></p></td>
<td><p>avgfoo0.f00000</p></td>
<td><p>scalar i</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\overline{u^2}\)</span></p></td>
<td><p>rmsfoo0.f00000</p></td>
<td><p>u-velocity</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\overline{v^2}\)</span></p></td>
<td><p>rmsfoo0.f00000</p></td>
<td><p>v-velocity</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\overline{w^2}\)</span></p></td>
<td><p>rmsfoo0.f00000</p></td>
<td><p>w-velocity</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\overline{p^2}\)</span></p></td>
<td><p>rmsfoo0.f00000</p></td>
<td><p>pressure</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\overline{T^2}\)</span></p></td>
<td><p>rmsfoo0.f00000</p></td>
<td><p>temperature</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\overline{\phi_i^2}\)</span></p></td>
<td><p>rmsfoo0.f00000</p></td>
<td><p>scalar i</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\overline{uv}\)</span></p></td>
<td><p>rm2foo0.f00000</p></td>
<td><p>u-velocity</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\overline{vw}\)</span></p></td>
<td><p>rm2foo0.f00000</p></td>
<td><p>v-velocity</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\overline{uw}\)</span></p></td>
<td><p>rm2foo0.f00000</p></td>
<td><p>w-velocity</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\overline{p^2}\)</span></p></td>
<td><p>rm2foo0.f00000</p></td>
<td><p>pressure</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\overline{T^2}\)</span></p></td>
<td><p>rm2foo0.f00000</p></td>
<td><p>temperature</p></td>
</tr>
</tbody>
</table>
<dl class="field-list simple">
<dt class="field-odd">Note</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">avg_all</span></code> does NOT output enough information to reconstruct the turbulent heat fluxes by default.
Currently, custom user code is necessary to accomplish this.</p>
</dd>
</dl>
<p>The averaging files can then be reloaded into <em>Nek5000</em> as a standard restart file for post processing.
The files contain enough information to reconstruct Reynolds stresses considering that for a sufficiently large time-window at statistically steady state:</p>
<div class="math notranslate nohighlight">
\[\overline{u'u'}=\overline{u^2}-\overline{u}^2\]</div>
</section>
<section id="post-processing">
<span id="features-post"></span><h2>Post Processing<a class="headerlink" href="#post-processing" title="Permalink to this heading"></a></h2>
<p>TODO…</p>
</section>
<section id="objects">
<span id="features-obj"></span><h2>Objects<a class="headerlink" href="#objects" title="Permalink to this heading"></a></h2>
<p>TODO…</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="filter.html" class="btn btn-neutral float-left" title="Stabilizing Filters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../tutorials.html" class="btn btn-neutral float-right" title="Tutorials" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2015-2022, UCHICAGO ARGONNE, LLC.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>